{% extends "base.html" %}

{% block title %}
  <title>Model Audit</title>
{% endblock %}

{% block content %}
<body id="ModelAuditPage">

  
<br>
<div class="container" style="padding-top:60px; margin-left: 8%;">

<!---- Form for selecting team -------->
  <div class="btn-group">
      <div class="dropdown" id="MetadataTeamSelect">
        <a class="btn dropdown-toggle m-1" href="#" role="button" id="dropdownMenuLink" data-bs-toggle='dropdown' aria-haspopup="true" aria-expanded="false">
          
          {% if selected_team is not none %}
            {{selected_team}}
          {% else %}
            Select Team
          {% endif %}

        </a>
      
        <div class="dropdown-menu scrollable-menu" aria-labelledby="dropdownMenuLink">
          {% if teams is not none %}

            {% for team in teams %}
              <a class="dropdown-item" href="/opsml/audit/?team={{team}}">{{team}}</a>
            {% endfor %}
          
            {% else %}
            <a class="dropdown-item" href="#">No Team Found</a>
            {% endif %}
        </div>
      </div>

      <div class="dropdown" id="MetadataTeamSelect">
        <a class="btn dropdown-toggle m-1" href="#" role="button" id="dropdownMenuLink" data-bs-toggle='dropdown' aria-haspopup="true" aria-expanded="false">
          
          {% if selected_model is not none %}
            {{selected_model}}
          {% else %}
            Select Model
          {% endif %}
    
        </a>
        <div class="dropdown-menu scrollable-menu" aria-labelledby="dropdownMenuLink">
          {% if models is not none %}
            {% for model in models %}
              <a class="dropdown-item" href="/opsml/audit/?team={{selected_team}}&model={{model}}">{{model}}</a>
            {% endfor %}
          {% endif %}
        </div>
      </div>


      <div class="dropdown" id="MetadataTeamSelect">
        <a class="btn dropdown-toggle m-1" href="#" role="button" id="dropdownMenuLink" data-bs-toggle='dropdown' aria-haspopup="true" aria-expanded="false">
          {% if version is not none %}
            {{version}}
          {% else %}
            Select Version
          {% endif %}
        </a>
      
        <div class="dropdown-menu scrollable-menu" aria-labelledby="dropdownMenuLink">
          {% if versions is not none %}
            {% for version in versions %}
              <a class="dropdown-item" href="/opsml/audit/?team={{selected_team}}&model={{selected_model}}&version={{version}}">{{version}}</a>
            {% endfor %}
          {% endif %}
        </div>
      </div>

  </div>



  {% if audit_report is not none %}

<br>
<br>
<div class="container" id="PageHeader">
    <div class="page-header">
      <div style="clear: both">
        <h2  style="display: inline-block">AuditCard for {{selected_model}}:{{version}}</h2>

        {% if audit_report["timestamp"] is not none %}
          <h5  style="display: inline-block; float:right;">Updated at: {{audit_report["timestamp"]}}</h5>
        {% endif %}
      </div>
    <hr>

      {% if audit_report["status"] == true %}

      <h3>Status: <font color="green">Approved</font></h3>

      {% else %}

      <h3>Status: <font color="red">Not Approved</font></h3>

      {% endif %}
 
    </div>


</div>

<br>

  <form action="/opsml/audit/save" method="POST" id="AuditForm" name="AuditForm">
    <div class="form-group row">
      <div class="col">
        <label for="InputName">Audit Name</label>
        <input name="name" type="text" class="form-control" id="InputName" placeholder="Name" {% if audit_report["name"] is not none %} value={{audit_report["name"]}} {% endif %} required>
      </div>
      <div class="col">
        <label for="InputTeam">Team</label>
        <input name="team" type="text" class="form-control" id="InputTeam" placeholder="Team" {% if audit_report["team"] is not none %} value={{audit_report["team"]}} {% endif %} required>
      </div>
      <div class="col">
        <label for="InputEmail">User Email</label>
        <input name="email" type="text" class="form-control" id="InputEmail" placeholder="Email" {% if audit_report["user_email"] is not none %} value={{audit_report["user_email"]}} {% endif %} required>
      </div>
          <input name="selected_model_name" type="hidden" class="form-control" id="InputModelName" value={{selected_model}}>
          <input name="selected_model_team" type="hidden" class="form-control" id="InputModelTeam" value={{selected_team}}>
          <input name="selected_model_version" type="hidden" class="form-control" id="InputModelVersion" value={{version}}>
          <input name="uid" type="hidden" class="form-control" id="InputUid" {% if audit_report["uid"] is not none %} value={{audit_report["uid"]}} {% endif %}>
    </div>
    <br>

    
    <div class="accordion accordion-flush" id="AuditAccordion">
    {% for section, section_data in audit_report["audit"].items() %}


        {% with section=section, section_data=section_data %}
        {% include "include/audit/audit_section.html" %}
        {% endwith %}
    {% endfor %}
    </div>



    <br>
      <button id="AuditSubmit" type="submit" class="btn btn-primary" style="background:#038767; color:#fffefe; border:none">Save AuditCard</button>

  </form>

  <div class="container">
    <div class="col-md-8 col-lg-6">
      <div class="card shadow-0 border" style="background-color: #f0f2f5;">
        <div class="comment-block">
          <h4 class="comments-title">Comments</h4>
  
          <form class="form-block">
            <div class="row">
              <div class="col-md-8 col-lg-6">
                <div class="form-group fl_icon">
                  <div class="icon"><i class="fa fa-user"></i></div>
                  <input class="form-input" type="text" placeholder="Your name">
                </div>
              </div>
              <div class="col-md-8">									
                <div class="form-group">
                  <textarea class="form-input" required="" placeholder="Your text"></textarea>
                </div>
              </div>
              <a class="btn btn-primary pull-right">submit</a>
            </div>
          </form>
  
          {% if audit_report["comments"]|length > 0 %}
            {% for comment in audit_report["comments"] %}
              {% with comment = comment %}
              {% include "include/audit/comment_card.html" %}
              {% endwith %}
            {% endfor %}
          {% endif %}
    
          </div>
        </div>
      </div>
    </div>
  </div>
  

  {% endif %}



</div>


</body>

{% endblock %}

